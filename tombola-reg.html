<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Lokamania 5 — Registration</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --bg:#f3f4f6;
      --ink:#111827;
      --muted:#6b7280;
      --panel:#ffffff;
      --panel-soft:#f9fafb;
      --accent:#f97316;
      --accent-alt:#0f766e;
      --accent-red:#ef4444;
      --accent-soft:#ffedd5;
      --radius-lg:22px;
      --radius-md:14px;
      --shadow-lg:0 22px 55px rgba(15,23,42,0.26);
      --shadow-md:0 14px 30px rgba(15,23,42,0.16);
    }
    *{box-sizing:border-box;margin:0;padding:0;}

    body{
      font-family:"Montserrat",system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      min-height:100vh;
      background:
        radial-gradient(circle at 10% 0%,rgba(248,250,252,0.9),rgba(248,250,252,0) 40%),
        radial-gradient(circle at 90% 0%,rgba(254,243,199,0.9),rgba(254,243,199,0) 50%),
        radial-gradient(circle at 0% 100%,rgba(191,219,254,0.85),rgba(191,219,254,0) 55%),
        #e5e7eb;
      color:var(--ink);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px 12px;
      overflow-x:hidden;
    }

    .shell{
      position:relative;
      width:100%;
      max-width:980px;
      min-height:520px;
      display:grid;
      grid-template-columns:minmax(0,3fr) minmax(0,2.3fr);
      gap:22px;
      align-items:stretch;
    }

    /* Hero */
    .hero{
      border-radius:var(--radius-lg);
      background:linear-gradient(145deg,rgba(15,23,42,0.96),rgba(15,23,42,0.88));
      color:#f9fafb;
      padding:22px;
      box-shadow:var(--shadow-lg);
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      gap:16px;
    }

    .hero-header{
      display:flex;
      align-items:center;
      gap:14px;
      flex-wrap:wrap;
    }

    /* Circle logo */
    .logo-badge{
      width:90px;
      height:90px;
      border-radius:50%;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      box-shadow:0 10px 25px rgba(0,0,0,0.4);
      flex-shrink:0;
    }
    .logo-image{
      width:100%;
      height:auto;
      object-fit:contain;
      background:#000;
      border-radius:50%;
    }

    .hero-kicker{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.22em;
      color:rgba(226,232,240,0.78);
    }
    .hero-title{
      font-size:22px;
      font-weight:700;
      text-transform:uppercase;
    }

    .hero-list{
      margin-top:12px;
      font-size:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .hero-list li{
      display:flex;
      gap:10px;
    }
    .hero-dot{
      width:6px;height:6px;border-radius:50%;
      background:linear-gradient(135deg,#f97316,#facc15);
      margin-top:4px;
      flex-shrink:0;
    }

    .hero-footer-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size:12px;
      gap:10px;
      flex-wrap:wrap;
    }

    .hero-tag{
      font-size:10px;
      padding:4px 8px;
      border-radius:999px;
      background:rgba(255,255,255,0.12);
    }

    /* Form card */
    .form-card{
      background:#ffffffee;
      border-radius:var(--radius-lg);
      box-shadow:var(--shadow-md);
      padding:20px;
      position:relative;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
    }

    .form-title{
      font-size:18px;
      font-weight:700;
      margin-bottom:4px;
    }
    .form-subtitle{
      font-size:11px;
      color:var(--muted);
      margin-bottom:10px;
    }

    form{
      margin-top:6px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .field-group{
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    .field-label{
      font-size:11px;
      font-weight:600;
      text-transform:uppercase;
      color:var(--muted);
      letter-spacing:0.08em;
    }

    .input, select{
      border-radius:11px;
      border:1px solid #e5e7eb;
      padding:7px 9px;
      font-size:13px;
      background:var(--panel-soft);
      font-family:inherit;
    }

    .radio-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .chip-option{
      display:flex;
      align-items:center;
      gap:4px;
      padding:6px 9px;
      border-radius:999px;
      background:#fff;
      border:1px solid #e5e7eb;
      font-size:11px;
    }

    .error-text{
      font-size:11px;
      color:#b91c1c;
      display:none;
    }

    .btn-primary{
      margin-top:4px;
      padding:9px 14px;
      border-radius:999px;
      background:radial-gradient(circle,#facc15,#f97316 50%,#ef4444);
      color:#111827;
      font-weight:600;
      cursor:pointer;
      border:none;
      font-size:13px;
      align-self:flex-start;
    }

    /* Success */
    .success-panel{
      position:absolute;
      inset:0;
      background:#fffdf2;
      display:none;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      text-align:center;
      padding:20px;
    }
    .success-panel.visible{
      display:flex;
    }
    .success-number{
      font-size:28px;
      font-weight:800;
      color:#0f766e;
      margin:8px 0;
    }

    /* MOBILE RESPONSIVE */
    @media (max-width:900px){
      body{
        padding:14px 10px;
      }
      .shell{
        grid-template-columns:minmax(0,1fr);
        max-width:540px;
      }
      .hero{
        order:-1;
      }
    }

    @media (max-width:540px){
      .hero{
        padding:18px 16px;
      }
      .form-card{
        padding:16px 14px 18px;
      }
      .hero-title{
        font-size:18px;
      }
      .form-title{
        font-size:16px;
      }
      .logo-badge{
        width:72px;
        height:72px;
      }
    }
  </style>
</head>

<body>
<div class="shell">

  <!-- Left -->
  <aside class="hero">
    <div>
      <div class="hero-header">
        <div class="logo-badge">
          <img
            src="https://firebasestorage.googleapis.com/v0/b/events-339ce.firebasestorage.app/o/lokamania%205%20logo.png?alt=media&token=49f14bf3-b113-4653-84a6-3857275ad410"
            alt="Lokamania logo"
            class="logo-image"
          >
        </div>

        <div>
          <div class="hero-kicker">Lokamania Raffle</div>
          <div class="hero-title">Registration · 5th Edition</div>
        </div>
      </div>

      <ul class="hero-list">
        <li>
          <div class="hero-dot"></div>
          <div>Register once · receive your unique raffle number on your email.</div>
        </li>
        <li>
          <div class="hero-dot"></div>
          <div>At the end of the event, one raffle number is randomly drawn to win a reward.</div>
        </li>
        <li>
          <div class="hero-dot"></div>
          <div>Your raffle number will be sent to the email you provide below.</div>
        </li>
      </ul>
    </div>

    <div class="hero-footer-row">
      <span>Lokamania 5 — Registration</span>
      <div style="display:flex; gap:6px; flex-wrap:wrap;">
        <span class="hero-tag">Local brands</span>
        <span class="hero-tag">Streetwear & lifestyle</span>
        <span class="hero-tag">Community</span>
      </div>
    </div>
  </aside>

  <!-- Form -->
  <section class="form-card" id="formCard">
    <div class="form-title">Register to get your raffle number</div>
    <div class="form-subtitle">One quick step · we’ll email you your unique raffle number.</div>

    <form id="registrationForm" novalidate>

      <div class="field-group">
        <div class="field-label">Full Name *</div>
        <input class="input" name="name" placeholder="Your full name">
        <div class="error-text" id="err-name"></div>
      </div>

      <div class="field-group">
        <div class="field-label">Phone *</div>
        <input class="input" name="phone" type="tel" placeholder="+20…">
        <div class="error-text" id="err-phone"></div>
      </div>

      <div class="field-group">
        <div class="field-label">Email *</div>
        <input class="input" name="email" type="email" placeholder="your@email.com">
        <div class="error-text" id="err-email"></div>
      </div>

      <div class="field-group">
        <div class="field-label">Gender *</div>
        <div class="radio-row">
          <label class="chip-option"><input type="radio" name="gender" value="female"> Female</label>
          <label class="chip-option"><input type="radio" name="gender" value="male"> Male</label>
          <label class="chip-option"><input type="radio" name="gender" value="prefer_not"> Prefer not to say</label>
        </div>
        <div class="error-text" id="err-gender"></div>
      </div>

      <div class="field-group">
        <div class="field-label">Age group *</div>
        <select class="input" name="ageGroup">
          <option value="">Select one</option>
          <option value="13-17">13–17</option>
          <option value="18-24">18–24</option>
          <option value="25-34">25–34</option>
          <option value="35-44">35–44</option>
          <option value="45+">45+</option>
        </select>
        <div class="error-text" id="err-age"></div>
      </div>

      <div class="field-group">
        <div class="field-label">Favorite brand</div>
        <input class="input" name="favoriteBrand" placeholder="Your favorite brand">
      </div>

      <button class="btn-primary" id="submitBtn" type="submit">Get my raffle number ✨</button>
    </form>

    <!-- Success -->
    <div class="success-panel" id="successPanel">
      <h2 style="margin-bottom:6px;">You’re in!</h2>
      <div>Your raffle number is:</div>
      <div class="success-number" id="successNumber"></div>
      <p style="font-size:13px; max-width:260px;">
        Your raffle number has been saved and sent to your email.
      </p>
      <button class="btn-primary" id="successCloseBtn">Done</button>
    </div>
  </section>

</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getDatabase, ref, push, get, runTransaction
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  import {
    getAuth, signInAnonymously
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey:"AIzaSyA80bAAGPuyscnTVS-zwrxE9Jp3tPiS1gM",
    authDomain:"events-339ce.firebaseapp.com",
    projectId:"events-339ce",
    storageBucket:"events-339ce.firebasestorage.app",
    messagingSenderId:"175601544315",
    appId:"1:175601544315:web:00c94b4affa972b3a286de",
    databaseURL:"https://events-339ce-default-rtdb.europe-west1.firebasedatabase.app"
  };

  const LOGO_URL = "https://firebasestorage.googleapis.com/v0/b/events-339ce.firebasestorage.app/o/lokamania%205%20logo.png?alt=media&token=49f14bf3-b113-4653-84a6-3857275ad410";
  const EVENT_ID = "lokamania5";
  const WEBHOOK_URL = "https://farid-seven.app.n8n.cloud/webhook-test/a25f6f37-cbb0-4bb8-9d3a-161bcef4ab9c";

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  const registrationsRef = ref(db, `events/${EVENT_ID}/registrations`);
  const raffleLastRef = ref(db, `events/${EVENT_ID}/raffleLast`);

  signInAnonymously(auth).catch(console.error);

  async function nextRaffleNumber(){
    const result = await runTransaction(raffleLastRef, current => {
      if(current === null) return 1001;
      return current + 1;
    });
    return result.snapshot.val();
  }

  document.getElementById("registrationForm").addEventListener("submit", async e=>{
    e.preventDefault();

    const name = e.target.name.value.trim();
    const phone = e.target.phone.value.trim();
    const email = e.target.email.value.trim().toLowerCase();
    const gender = document.querySelector("input[name=gender]:checked")?.value || "";
    const age = e.target.ageGroup.value.trim();
    const fav = e.target.favoriteBrand.value.trim();

    let ok = true;
    function err(id,msg){
      const el = document.getElementById(id);
      el.textContent = msg;
      el.style.display = "block";
      ok = false;
    }
    document.querySelectorAll(".error-text").forEach(x=>{x.style.display="none";});

    if(!name) err("err-name","This field is required.");
    if(!phone || phone.replace(/\s+/g,"").length<8) err("err-phone","Please enter a valid phone.");
    if(!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) err("err-email","Please enter a valid email.");
    if(!gender) err("err-gender","Please choose an option.");
    if(!age) err("err-age","Please select your age group.");

    if(!ok) return;

    const raffleNumber = await nextRaffleNumber();

    const payload = {
      name,
      phone,
      email,
      gender,
      ageGroup: age,
      favoriteBrand: fav,
      raffleNumber,
      createdAt: Date.now(),
      logoUrl: LOGO_URL
    };

    await push(registrationsRef, payload);

    await fetch(WEBHOOK_URL,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        type:"lokamania_registration",
        eventId:EVENT_ID,
        raffleNumber,
        logoUrl: LOGO_URL,
        data: payload
      })
    }).catch(console.warn);

    document.getElementById("successNumber").textContent = "#" + raffleNumber;
    document.getElementById("successPanel").classList.add("visible");
  });

  document.getElementById("successCloseBtn").addEventListener("click",()=>{
    location.reload();
  });
</script>

</body>
</html>
